# Automated CLI Documentation Implementation Plan

## Goal

Implement automated creation of documentation for the retrocast CLI. The documentation should be derived directly from the help text of CLI tools using the cog tool.

## Requirements

Based on the requirements document (`plans/2026-02-12-automated-cli-docs.md`):

1. Use the `cogapp` package for automated documentation generation
2. Create documentation in the `docs/` directory
3. Generate one markdown file per first-level subcommand
4. Include comprehensive explanations of suboptions and arguments
5. Provide usage examples
6. Add poe tasks to generate updated documentation
7. Only go one level deep on subcommand groups

## Implementation Tasks

- [x] **Add cogapp Dependency**
  - Added `cogapp>=3.0.0` to `[project.optional-dependencies]` under a new `docs` group
  - Users can install with: `pip install retrocast[docs]`

- [x] **Create Documentation Directory Structure**
  - Created `docs/cli/` directory for CLI reference documentation
  - Separate from existing `docs/` content (TRANSCRIPTION.md, CASTCHAT.md)

- [x] **Generate Documentation Files**
  - Created comprehensive documentation for all command groups:
    - `index.md` - Main CLI reference with overview
    - `about.md` - About command
    - `castchat.md` - Interactive AI chat
    - `config.md` - Configuration management (5 subcommands)
    - `download.md` - Episode downloads (3 subcommands, including nested db commands)
    - `meta.md` - Metadata downloads (overcast subgroup)
    - `sql.md` - SQL queries (12 sqlite-utils subcommands)
    - `sync.md` - Synchronization (overcast subgroup with 11 subcommands)
    - `transcription.md` - Transcription management (7 subcommands)
    - `README.md` - Documentation guide

- [x] **Add Cog Directives**
  - Each documentation file includes cog preambles that:
    - Import CliRunner and cli from retrocast.cli
    - Invoke commands with --help flag
    - Capture and format output in markdown code blocks
  - Pattern follows Simon Willison's approach from llm documentation

- [x] **Create Poe Tasks**
  - Added `docs:generate` task: `python -m cogapp -r docs/cli/*.md`
    - Regenerates all CLI documentation
  - Added `docs:check` task: `python -m cogapp --check docs/cli/*.md`
    - Verifies documentation is up to date (useful for CI)

- [x] **Test Documentation Generation**
  - Successfully ran cog on all documentation files
  - Verified output includes correct help text
  - Confirmed poe tasks work correctly

- [x] **Add Usage Examples**
  - Each command includes practical examples
  - Documented common workflows (initial setup, regular updates, etc.)
  - Included tips and best practices

## Documentation Structure

### File Organization

```
docs/cli/
├── README.md              # Documentation guide
├── index.md               # Main CLI reference
├── about.md               # about command
├── castchat.md            # castchat command
├── config.md              # config subcommands
├── download.md            # download subcommands
├── meta.md                # meta subcommands
├── sql.md                 # sql subcommands
├── sync.md                # sync subcommands
└── transcription.md       # transcription subcommands
```

### Content Pattern

Each file follows this structure:

1. **Title and Description** - Command purpose and overview
2. **Command Group Help** - Top-level --help output (generated by cog)
3. **Subcommands** - For command groups:
   - Subcommand description
   - Help output (generated by cog)
   - Usage examples
   - Tips and notes
4. **Examples Section** - Practical usage examples
5. **Additional Information** - Tips, workflows, storage locations, etc.

### Cog Integration

Cog directives are embedded in markdown:

```markdown
<!-- [[[cog
from click.testing import CliRunner
from retrocast.cli import cli
result = CliRunner().invoke(cli, ["command", "--help"])
cog.out("```\n{}\n```".format(result.output))
]]] -->
<!-- [[[end]]] -->
```

The content between `]]]` and `[[[end]]]` is automatically generated.

## Usage

### Generate Documentation

```bash
poe docs:generate
```

Or directly:

```bash
python -m cogapp -r docs/cli/*.md
```

### Check Documentation

```bash
poe docs:check
```

This verifies documentation matches current CLI help output.

### Install Dependencies

```bash
pip install retrocast[docs]
```

## Benefits

1. **Always Up to Date** - Documentation is generated from actual CLI help
2. **Single Source of Truth** - Help text in code is the source
3. **Easy to Maintain** - Just run `poe docs:generate` after CLI changes
4. **CI Integration** - `poe docs:check` can catch outdated docs
5. **Comprehensive** - Covers all commands and subcommands
6. **Rich Examples** - Includes usage examples and workflows

## Future Enhancements

Potential improvements:

1. **Strip ANSI Codes** - Remove color codes from rich-click output for cleaner docs
2. **CI Integration** - Add `docs:check` to GitHub Actions
3. **Link to Source** - Add links to source code for each command
4. **Search Index** - Generate search index for documentation
5. **Version Badges** - Show which version introduced each command
6. **Interactive Examples** - Add copy-to-clipboard buttons in web view

## Notes

- Rich-click formatting includes ANSI color codes in help output
- Documentation captures actual command behavior at generation time
- One level deep per requirements (command groups with their subcommands)
- Comprehensive coverage of all CLI functionality

## Completion Status

✅ **COMPLETE** - All tasks from the requirements document have been implemented:

- [x] cogapp package added as dependency
- [x] docs/cli/ directory created
- [x] Documentation files created for all command groups
- [x] Cog preambles added to all files
- [x] Poe tasks created for generation and checking
- [x] Documentation tested and verified
- [x] Usage examples and workflows included
- [x] README guide created

The automated CLI documentation system is now fully functional and ready for use.
